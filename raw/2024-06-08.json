[{"node": {"avatar_large": "https://cdn.v2ex.com/navatar/093f/65e0/59_large.png?m=1615956453", "name": "random", "avatar_normal": "https://cdn.v2ex.com/navatar/093f/65e0/59_normal.png?m=1615956453", "title": "随想", "url": "https://www.v2ex.com/go/random", "topics": 3752, "footer": "", "header": "有的时候，可以停下来找找灵感，然后再继续。", "title_alternative": "Random", "avatar_mini": "https://cdn.v2ex.com/navatar/093f/65e0/59_mini.png?m=1615956453", "stars": 1204, "aliases": [], "root": false, "id": 59, "parent_node_name": "v2ex"}, "member": {"id": 550645, "username": "lfitzgerald", "url": "https://www.v2ex.com/u/lfitzgerald", "website": null, "twitter": null, "psn": null, "github": null, "btc": null, "location": null, "tagline": null, "bio": null, "avatar_mini": "https://cdn.v2ex.com/avatar/bb35/5a05/550645_mini.png?m=1715408821", "avatar_normal": "https://cdn.v2ex.com/avatar/bb35/5a05/550645_normal.png?m=1715408821", "avatar_large": "https://cdn.v2ex.com/avatar/bb35/5a05/550645_large.png?m=1715408821", "avatar_xlarge": "https://cdn.v2ex.com/avatar/bb35/5a05/550645_xlarge.png?m=1715408821", "avatar_xxlarge": "https://cdn.v2ex.com/avatar/bb35/5a05/550645_xlarge.png?m=1715408821", "created": 1626061040, "last_modified": 1715408821}, "last_reply_by": "horizon", "last_touched": 1717851196, "title": "观《媳妇坐月子。。。。》有感，我敢说 95%的烟鬼不在乎别人感受", "url": "https://www.v2ex.com/t/1047883", "created": 1717813665, "deleted": 0, "content": "在厕所抽烟，在电梯抽烟，在阳台抽烟把烟头往下丢\r\n没有常识", "content_rendered": "<p>在厕所抽烟，在电梯抽烟，在阳台抽烟把烟头往下丢\n没有常识</p>\n", "last_modified": 1717814010, "replies": 94, "id": 1047883}, {"node": {"avatar_large": "https://cdn.v2ex.com/navatar/e7b2/4b11/360_large.png?m=1670319927", "name": "windows", "avatar_normal": "https://cdn.v2ex.com/navatar/e7b2/4b11/360_normal.png?m=1670319927", "title": "Windows", "url": "https://www.v2ex.com/go/windows", "topics": 3906, "footer": "", "header": "Windows, not walls.", "title_alternative": "Windows", "avatar_mini": "https://cdn.v2ex.com/navatar/e7b2/4b11/360_mini.png?m=1670319927", "stars": 1244, "aliases": [], "root": false, "id": 360, "parent_node_name": "os"}, "member": {"id": 544482, "username": "FishStars", "url": "https://www.v2ex.com/u/FishStars", "website": "", "twitter": null, "psn": null, "github": null, "btc": null, "location": "", "tagline": "如果人没了目标，那跟无忧无虑有什么区别？", "bio": "", "avatar_mini": "https://cdn.v2ex.com/avatar/1cf7/bbdf/544482_mini.png?m=1659520115", "avatar_normal": "https://cdn.v2ex.com/avatar/1cf7/bbdf/544482_normal.png?m=1659520115", "avatar_large": "https://cdn.v2ex.com/avatar/1cf7/bbdf/544482_large.png?m=1659520115", "avatar_xlarge": "https://cdn.v2ex.com/avatar/1cf7/bbdf/544482_xlarge.png?m=1659520115", "avatar_xxlarge": "https://cdn.v2ex.com/avatar/1cf7/bbdf/544482_xlarge.png?m=1659520115", "avatar_xxxlarge": "https://cdn.v2ex.com/avatar/1cf7/bbdf/544482_xlarge.png?m=1659520115", "created": 1620189848, "last_modified": 1659520115}, "last_reply_by": "Garphy", "last_touched": 1717844694, "title": "ThinkPad X1 carbon 值得入手吗？想入手一款轻薄本出差+日常办公", "url": "https://www.v2ex.com/t/1047871", "created": 1717808127, "deleted": 0, "content": "已经很久没有使用 win 了，网上对 X1 褒贬不一，不太懂怎么选择。\r\n备注：因为时不时需要 U 盘读写，工作环境也不太好，所以 mac air 就排除了。总量+性能都兼顾的情况下，大佬们有啥推荐不（价格 5K-10K ）", "content_rendered": "<p>已经很久没有使用 win 了，网上对 X1 褒贬不一，不太懂怎么选择。\n备注：因为时不时需要 U 盘读写，工作环境也不太好，所以 mac air 就排除了。总量+性能都兼顾的情况下，大佬们有啥推荐不（价格 5K-10K ）</p>\n", "last_modified": 1717808172, "replies": 60, "id": 1047871}, {"node": {"avatar_large": "https://cdn.v2ex.com/navatar/c20a/d4d7/12_large.png?m=1650095340", "name": "qna", "avatar_normal": "https://cdn.v2ex.com/navatar/c20a/d4d7/12_normal.png?m=1650095340", "title": "问与答", "url": "https://www.v2ex.com/go/qna", "topics": 219756, "footer": "", "header": "一个更好的世界需要你持续地提出好问题。", "title_alternative": "Questions and Answers", "avatar_mini": "https://cdn.v2ex.com/navatar/c20a/d4d7/12_mini.png?m=1650095340", "stars": 4186, "aliases": [], "root": false, "id": 12, "parent_node_name": "v2ex"}, "member": {"id": 115394, "username": "yoa1q7y", "url": "https://www.v2ex.com/u/yoa1q7y", "website": "", "twitter": "", "psn": "", "github": "", "btc": "", "location": "", "tagline": "", "bio": "", "avatar_mini": "https://cdn.v2ex.com/avatar/7ce3/0f00/115394_mini.png?m=1697021831", "avatar_normal": "https://cdn.v2ex.com/avatar/7ce3/0f00/115394_normal.png?m=1697021831", "avatar_large": "https://cdn.v2ex.com/avatar/7ce3/0f00/115394_large.png?m=1697021831", "created": 1430838911, "last_modified": 1697021831}, "last_reply_by": "BZGOGO", "last_touched": 1717849498, "title": "各位使用自建节点的朋友都是用的什么内核和协议？", "url": "https://www.v2ex.com/t/1047885", "created": 1717814728, "deleted": 0, "content": "自建的优势就是自由度很高，有了机器 + 域名 + 证书，各种内核和协议可以随便搭建折腾\r\n\r\n目前比较主流的内核有：\r\n\r\n- Xray\r\n- sing-box\r\n- Clash\r\n- mihomo\r\n- ...\r\n\r\n主流的协议有：\r\n\r\n- Shadowsocks\r\n- VMess\r\n- VLESS\r\n- Trojan\r\n- Hysteria\r\n- Hysteria2\r\n- ...\r\n\r\n用了很久的 VLESS-TCP-TLS-WS ，感觉兼容性和安全性相对好一些，也用过一段时间的 VLESS-TCP-XTLS-Vision-REALITY ，不过有些客户端不支持\r\n\r\n不知道各位都用的啥，选择的理由是什么", "content_rendered": "<p>自建的优势就是自由度很高，有了机器 + 域名 + 证书，各种内核和协议可以随便搭建折腾</p>\n<p>目前比较主流的内核有：</p>\n<ul>\n<li>Xray</li>\n<li>sing-box</li>\n<li>Clash</li>\n<li>mihomo</li>\n<li>...</li>\n</ul>\n<p>主流的协议有：</p>\n<ul>\n<li>Shadowsocks</li>\n<li>VMess</li>\n<li>VLESS</li>\n<li>Trojan</li>\n<li>Hysteria</li>\n<li>Hysteria2</li>\n<li>...</li>\n</ul>\n<p>用了很久的 VLESS-TCP-TLS-WS ，感觉兼容性和安全性相对好一些，也用过一段时间的 VLESS-TCP-XTLS-Vision-REALITY ，不过有些客户端不支持</p>\n<p>不知道各位都用的啥，选择的理由是什么</p>\n", "last_modified": 1717814728, "replies": 43, "id": 1047885}, {"node": {"avatar_large": "https://cdn.v2ex.com/navatar/c20a/d4d7/12_large.png?m=1650095340", "name": "qna", "avatar_normal": "https://cdn.v2ex.com/navatar/c20a/d4d7/12_normal.png?m=1650095340", "title": "问与答", "url": "https://www.v2ex.com/go/qna", "topics": 219756, "footer": "", "header": "一个更好的世界需要你持续地提出好问题。", "title_alternative": "Questions and Answers", "avatar_mini": "https://cdn.v2ex.com/navatar/c20a/d4d7/12_mini.png?m=1650095340", "stars": 4186, "aliases": [], "root": false, "id": 12, "parent_node_name": "v2ex"}, "member": {"id": 613774, "username": "kelvinaltajiin", "url": "https://www.v2ex.com/u/kelvinaltajiin", "website": null, "twitter": null, "psn": null, "github": null, "btc": null, "location": null, "tagline": null, "bio": null, "avatar_mini": "https://cdn.v2ex.com/avatar/8e9e/eb9b/613774_mini.png?m=1717818412", "avatar_normal": "https://cdn.v2ex.com/avatar/8e9e/eb9b/613774_normal.png?m=1717818412", "avatar_large": "https://cdn.v2ex.com/avatar/8e9e/eb9b/613774_large.png?m=1717818412", "avatar_xlarge": "https://cdn.v2ex.com/avatar/8e9e/eb9b/613774_xlarge.png?m=1717818412", "avatar_xxlarge": "https://cdn.v2ex.com/avatar/8e9e/eb9b/613774_xlarge.png?m=1717818412", "avatar_xxxlarge": "https://cdn.v2ex.com/avatar/8e9e/eb9b/613774_xlarge.png?m=1717818412", "created": 1676251984, "last_modified": 1717818412}, "last_reply_by": "ysc3839", "last_touched": 1717851459, "title": "小米 13U 无法注册八达通, 内置 Google 框架, 八达通 app 从 google play 下载安装. google 了一圈没有什么结果,请问大家有没有谁遇到过,怎么解决?", "url": "https://www.v2ex.com/t/1047897", "created": 1717818827, "deleted": 0, "content": "https://i.imgur.com/18Rkizi.jpeg", "content_rendered": "<a target=\"_blank\" href=\"https://i.imgur.com/18Rkizi.jpeg\" rel=\"nofollow noopener\" target=\"_blank\"><img src=\"https://i.imgur.com/18Rkizi.jpeg\" class=\"embedded_image\" rel=\"noreferrer\"></a>", "last_modified": 1717818827, "replies": 35, "id": 1047897}, {"node": {"avatar_large": "https://cdn.v2ex.com/navatar/c9f0/f895/8_large.png?m=1630643991", "name": "iphone", "avatar_normal": "https://cdn.v2ex.com/navatar/c9f0/f895/8_normal.png?m=1630643991", "title": "iPhone", "url": "https://www.v2ex.com/go/iphone", "topics": 11440, "footer": "这里绝不讨论如何获得 iPhone 盗版软件、iTunes 黑卡之类。", "header": "Say hello to the future.", "title_alternative": "iPhone", "avatar_mini": "https://cdn.v2ex.com/navatar/c9f0/f895/8_mini.png?m=1630643991", "stars": 3386, "aliases": [], "root": false, "id": 8, "parent_node_name": "apple"}, "member": {"id": 523633, "username": "imTerry", "url": "https://www.v2ex.com/u/imTerry", "website": "", "twitter": null, "psn": null, "github": null, "btc": null, "location": "", "tagline": "", "bio": "", "avatar_mini": "https://cdn.v2ex.com/gravatar/8113ccd959d525427e42f5fd27563b4a?s=24&d=retro", "avatar_normal": "https://cdn.v2ex.com/gravatar/8113ccd959d525427e42f5fd27563b4a?s=48&d=retro", "avatar_large": "https://cdn.v2ex.com/gravatar/8113ccd959d525427e42f5fd27563b4a?s=73&d=retro", "created": 1607867604, "last_modified": 1701311970}, "last_reply_by": "meganut", "last_touched": 1717850012, "title": "支付宝支持 iPhone NFC 了", "url": "https://www.v2ex.com/t/1047855", "created": 1717779449, "deleted": 0, "content": "https://i.imgur.com/9ycQ7bu\r\n首批城市好像好像只有上海，还集中在一个商场内。实现方式需要解锁 iPhone 状态才可以刷支付宝的专门的 NFC 设备。\r\n看来支付宝也认识到了 NFC 的重要性。", "content_rendered": "<a target=\"_blank\" href=\"https://i.imgur.com/9ycQ7bu\" rel=\"nofollow noopener\">https://i.imgur.com/9ycQ7bu</a><br />首批城市好像好像只有上海，还集中在一个商场内。实现方式需要解锁 iPhone 状态才可以刷支付宝的专门的 NFC 设备。<br />看来支付宝也认识到了 NFC 的重要性。", "last_modified": 1717779566, "replies": 31, "id": 1047855}, {"node": {"avatar_large": "https://cdn.v2ex.com/navatar/6e27/13a6/557_large.png?m=1608969785", "name": "life", "avatar_normal": "https://cdn.v2ex.com/navatar/6e27/13a6/557_normal.png?m=1608969785", "title": "生活", "url": "https://www.v2ex.com/go/life", "topics": 5932, "footer": "", "header": "生活中的技术讨论", "title_alternative": "Life", "avatar_mini": "https://cdn.v2ex.com/navatar/6e27/13a6/557_mini.png?m=1608969785", "stars": 1440, "aliases": [], "root": false, "id": 557, "parent_node_name": ""}, "member": {"id": 682268, "username": "zf1968", "url": "https://www.v2ex.com/u/zf1968", "website": null, "twitter": null, "psn": null, "github": null, "btc": null, "location": null, "tagline": null, "bio": null, "avatar_mini": "https://cdn.v2ex.com/gravatar/6936410a289b35c002f7580f63b7bd1d?s=24&d=retro", "avatar_normal": "https://cdn.v2ex.com/gravatar/6936410a289b35c002f7580f63b7bd1d?s=48&d=retro", "avatar_large": "https://cdn.v2ex.com/gravatar/6936410a289b35c002f7580f63b7bd1d?s=73&d=retro", "created": 1711550951, "last_modified": 1717821042}, "last_reply_by": "Sting1226", "last_touched": 1717574631, "title": "有没有一种猫零食，类似磨牙棒，吃不了多少，又能持续啃很久。", "url": "https://www.v2ex.com/t/1047904", "created": 1717821244, "deleted": 0, "content": "原因：\r\n猫一直叫，坚持不懈的叫，没皮没脸的叫，不分场合的叫，每次叫完挨打也要叫，就为要口好吃的。\r\n猫粮也管够，但就喜欢吃零食。\r\n更气人的是，零食给少了，他还要，零食给多了，它又吃了吐。冻干儿，罐头都是。\r\n\r\n或者大伙有什么其他办法不要让它总叫。", "content_rendered": "原因：<br />猫一直叫，坚持不懈的叫，没皮没脸的叫，不分场合的叫，每次叫完挨打也要叫，就为要口好吃的。<br />猫粮也管够，但就喜欢吃零食。<br />更气人的是，零食给少了，他还要，零食给多了，它又吃了吐。冻干儿，罐头都是。<br /><br />或者大伙有什么其他办法不要让它总叫。", "last_modified": 1717821244, "replies": 31, "id": 1047904}, {"node": {"avatar_large": "https://cdn.v2ex.com/navatar/6cdd/60ea/184_large.png?m=1630643913", "name": "apple", "avatar_normal": "https://cdn.v2ex.com/navatar/6cdd/60ea/184_normal.png?m=1630643913", "title": "Apple", "url": "https://www.v2ex.com/go/apple", "topics": 25682, "footer": "", "header": "设计了 <a href=\"/go/watch\">Apple Watch</a>，<a href=\"/go/ipad\">iPad</a>，<a href=\"/go/iphone\">iPhone</a>，<a href=\"/go/imac\">iMac</a> 及 <a href=\"/go/mbp\">MacBook Pro</a> 等电子产品的美国公司。", "title_alternative": "Apple", "avatar_mini": "https://cdn.v2ex.com/navatar/6cdd/60ea/184_mini.png?m=1630643913", "stars": 2949, "aliases": [], "root": false, "id": 184, "parent_node_name": "hardware"}, "member": {"id": 489734, "username": "AsianChampion", "url": "https://www.v2ex.com/u/AsianChampion", "website": null, "twitter": null, "psn": null, "github": null, "btc": null, "location": null, "tagline": null, "bio": null, "avatar_mini": "https://cdn.v2ex.com/gravatar/36438ad5787a0ba27823e02a0f774dbf?s=24&d=retro", "avatar_normal": "https://cdn.v2ex.com/gravatar/36438ad5787a0ba27823e02a0f774dbf?s=48&d=retro", "avatar_large": "https://cdn.v2ex.com/gravatar/36438ad5787a0ba27823e02a0f774dbf?s=73&d=retro", "created": 1589536517, "last_modified": 1641996566}, "last_reply_by": "lixintcwdsg", "last_touched": 1717850664, "title": "Mac 显示器求推荐", "url": "https://www.v2ex.com/t/1047890", "created": 1717816444, "deleted": 0, "content": "618 到了，想给 14 寸 Mbp 加个显示器，技术日新月异，也不想一步到位，2000 以内求显示器推荐。如果有性价比很好的，也可以超点预算。目前看下来有几个选项:\r\n\r\n1.优派 23.8 英寸 4K 超清 IPS HDR400 TypeC96W 10bit 旋转升降 微边 广色域 电脑显示器 24 VG2481-4K\r\nhttps://item.jd.com/100052760164.html\r\n\r\n2.LG 27 英寸 4K HDR400 IPS Type-C 90W 反向充电 满血版 27UP850N\r\nhttps://item.jd.com/100022124835.html\r\n\r\n3.小米 Redmi 27 英寸显示器 4K 超清 100%sRGB HDR400 Type-C 反向充电\r\nhttps://item.jd.com/100024459181.html\r\n\r\n听说 24 寸的 4k 比 27 寸的 4k 更适合 mac? 不知道实际使用体验如何。", "content_rendered": "618 到了，想给 14 寸 Mbp 加个显示器，技术日新月异，也不想一步到位，2000 以内求显示器推荐。如果有性价比很好的，也可以超点预算。目前看下来有几个选项:<br /><br />1.优派 23.8 英寸 4K 超清 IPS HDR400 TypeC96W 10bit 旋转升降 微边 广色域 电脑显示器 24 VG2481-4K<br /><a target=\"_blank\" href=\"https://item.jd.com/100052760164.html\" rel=\"nofollow noopener\">https://item.jd.com/100052760164.html</a><br /><br />2.LG 27 英寸 4K HDR400 IPS Type-C 90W 反向充电 满血版 27UP850N<br /><a target=\"_blank\" href=\"https://item.jd.com/100022124835.html\" rel=\"nofollow noopener\">https://item.jd.com/100022124835.html</a><br /><br />3.小米 Redmi 27 英寸显示器 4K 超清 100%sRGB HDR400 Type-C 反向充电<br /><a target=\"_blank\" href=\"https://item.jd.com/100024459181.html\" rel=\"nofollow noopener\">https://item.jd.com/100024459181.html</a><br /><br />听说 24 寸的 4k 比 27 寸的 4k 更适合 mac? 不知道实际使用体验如何。", "last_modified": 1717816444, "replies": 30, "id": 1047890}, {"node": {"avatar_large": "https://cdn.v2ex.com/navatar/94f6/d7e0/300_large.png?m=1700771269", "name": "programmer", "avatar_normal": "https://cdn.v2ex.com/navatar/94f6/d7e0/300_normal.png?m=1700771269", "title": "程序员", "url": "https://www.v2ex.com/go/programmer", "topics": 63070, "footer": "", "header": "While code monkeys are not eating bananas, they're coding.", "title_alternative": "Programmer", "avatar_mini": "https://cdn.v2ex.com/navatar/94f6/d7e0/300_mini.png?m=1700771269", "stars": 8982, "aliases": [], "root": false, "id": 300, "parent_node_name": "computer"}, "member": {"id": 460333, "username": "marquina", "url": "https://www.v2ex.com/u/marquina", "website": null, "twitter": null, "psn": null, "github": null, "btc": null, "location": null, "tagline": null, "bio": null, "avatar_mini": "https://cdn.v2ex.com/avatar/4841/3ba4/460333_mini.png?m=1682212038", "avatar_normal": "https://cdn.v2ex.com/avatar/4841/3ba4/460333_normal.png?m=1682212038", "avatar_large": "https://cdn.v2ex.com/avatar/4841/3ba4/460333_large.png?m=1682212038", "created": 1576813316, "last_modified": 1682212038}, "last_reply_by": "noclin", "last_touched": 1717850710, "title": "自建 Docker Hub 镜像服务", "url": "https://www.v2ex.com/t/1047891", "created": 1717817156, "deleted": 0, "content": "原文连接：[自建 Docker Hub 镜像服务 - OrangeWolf 的博客]( https://www.yooo.ltd/2024/06/08/self-host-docker-hub-mirror/)\r\n\r\n---\r\n\r\n# 1. 前言\r\n\r\n![]( https://picutres-1251933829.cos.ap-beijing.myqcloud.com//picgo/image-20240608093740935.png)\r\n\r\n最近在某些神秘力量的影响下，SJTUG/USTC 等知名 Docker Hub 镜像站陆续停止服务。\r\n\r\n文本使用[CNCF Distribution]( https://distribution.github.io/distribution)的 registry 项目，只需要运行一个 Docker 容器，就可以自建 Docker Hub 镜像服务。\r\n\r\n# 2. 所需条件\r\n\r\n- 可运行 Docker 容器的服务器\r\n- 可以访问 docker.io 的 HTTP 代理（如果服务器无法直接访问的话）\r\n\r\n# 3. 编写 registry 配置文件\r\n\r\n下面是笔者的 registry 配置文件，设置 Docker Hub 镜像的核心配置是`proxy`：\r\n\r\n```yaml\r\nversion: 0.1\r\nlog:\r\n  fields:\r\n    service: registry\r\nstorage:\r\n  cache:\r\n    blobdescriptor: inmemory\r\n  filesystem:\r\n    rootdirectory: /var/lib/registry\r\nhttp:\r\n  addr: :5000\r\n  headers:\r\n    X-Content-Type-Options: [nosniff]\r\nhealth:\r\n  storagedriver:\r\n    enabled: true\r\n    interval: 10s\r\n    threshold: 3\r\nproxy: # 关键镜像仓库配置\r\n  remoteurl: https://registry-1.docker.io\r\n  ttl: 168h\r\n```\r\n\r\n# 4. 生成 SSL 证书\r\n\r\nregistry 默认使用 HTTP 协议对外提供服务，使用 HTTPS 更安全&更通用。笔者生成自签名证书的命令如下：\r\n\r\n```shell\r\nopenssl req -x509 -newkey rsa:4096 -sha256 -days 3650 \\\r\n  -nodes -keyout example.com.key -out example.com.crt -subj \"/CN=example.com\" \\\r\n  -addext \"subjectAltName=DNS:example.com,DNS:*.example.com,IP:100.x.x.x,IP:192.168.1.30\"\r\n```\r\n\r\n# 5. 启动 registry 服务\r\n\r\n准备好 registry 的存储目录，放入上一步生成的证书文件。然后编写如下 docker-compose 文件：\r\n\r\n```yaml\r\nversion: '3.1'\r\nservices:\r\n  registry:\r\n    image: registry:2\r\n    network_mode: \"host\"\r\n    environment:\r\n      REGISTRY_HTTP_ADDR: \"0.0.0.0:5000\"\r\n      REGISTRY_HTTP_TLS_KEY: \"/var/lib/registry/example.com.key\"\r\n      REGISTRY_HTTP_TLS_CERTIFICATE: \"/var/lib/registry/example.com.crt\"\r\n      HTTPS_PROXY: \"{HTTP 代理地址}\"\r\n    restart: always\r\n    container_name: registry\r\n    volumes:\r\n      - \"/{你的路径}/registry:/var/lib/registry\"\r\n      - \"/{你的路径}/registry_config.yml:/etc/docker/registry/config.yml\"\r\n```\r\n\r\n用 docker-compose 运行容器即可启动服务：\r\n\r\n```shell\r\ndocker-compose -f registry.yml up -d\r\n```\r\n\r\n此时 registry 会在笔者的服务器上，也就是`https://192.168.1.30:5000`提供服务。\r\n\r\n# 6. 客户端使用\r\n\r\n## 6.1 信任 SSL 证书\r\n\r\n由于 registry 使用的是自签名 SSL 证书，客户端要想成功拉取镜像需要先信任该证书。方式有两种，第一种是将证书加入客户端的的系统信任列表（推荐）：\r\n\r\n```shell\r\nsudo cp /${你的路径}/example.com.crt /usr/share/ca-certificates\r\nsudo dpkg-reconfigure ca-certificates\r\n```\r\n\r\n然后重启 Docker/K3S 等需要拉取镜像的服务；第二种是让 Docker 拉取镜像时跳过证书校验：\r\n\r\n```shell\r\nsudo vim /etc/docker/daemon.json\r\n```\r\n\r\n```json\r\n\r\n{\r\n  ...\r\n  \"insecure-registries\": [\"192.168.1.30:5000\"]\r\n  ...\r\n}\r\n```\r\n\r\n然后重启 docker 服务。\r\n\r\n信任完证书后，此时就可以拉取 Docker Hub 上的镜像看到效果了：\r\n\r\n```shell\r\ndocker pull 192.168.1.30:5000/grafana/grafana:main\r\n```\r\n\r\n## 6.2 设置 Docker 镜像源\r\n\r\n同样是编辑`/etc/docker/daemon.json`，将上述 registry 服务作为 Docker 镜像源：\r\n\r\n```json\r\n{\r\n  ...\r\n  \"registry-mirrors\": [\r\n    \"https://192.168.1.30:5000\"\r\n  ]\r\n  ...\r\n}\r\n```\r\n\r\n然后重启 Docker 服务，此时就可以快速拉取镜像了\r\n\r\n```shell\r\ndocker pull grafana/grafana:main\r\n```\r\n\r\nenjoy!", "content_rendered": "<p>原文连接：<a href=\"https://www.yooo.ltd/2024/06/08/self-host-docker-hub-mirror/\" rel=\"nofollow\">自建 Docker Hub 镜像服务 - OrangeWolf 的博客</a></p>\n<hr/>\n<h1>1. 前言</h1>\n<p><img alt=\"\" class=\"embedded_image\" loading=\"lazy\" referrerpolicy=\"no-referrer\" rel=\"noreferrer\" src=\"https://picutres-1251933829.cos.ap-beijing.myqcloud.com//picgo/image-20240608093740935.png\"/></p>\n<p>最近在某些神秘力量的影响下，SJTUG/USTC 等知名 Docker Hub 镜像站陆续停止服务。</p>\n<p>文本使用<a href=\"https://distribution.github.io/distribution\" rel=\"nofollow\">CNCF Distribution</a>的 registry 项目，只需要运行一个 Docker 容器，就可以自建 Docker Hub 镜像服务。</p>\n<h1>2. 所需条件</h1>\n<ul>\n<li>可运行 Docker 容器的服务器</li>\n<li>可以访问 <a href=\"http://docker.io\" rel=\"nofollow\">docker.io</a> 的 HTTP 代理（如果服务器无法直接访问的话）</li>\n</ul>\n<h1>3. 编写 registry 配置文件</h1>\n<p>下面是笔者的 registry 配置文件，设置 Docker Hub 镜像的核心配置是<code>proxy</code>：</p>\n<pre><code class=\"language-yaml\">version: 0.1\nlog:\n  fields:\n    service: registry\nstorage:\n  cache:\n    blobdescriptor: inmemory\n  filesystem:\n    rootdirectory: /var/lib/registry\nhttp:\n  addr: :5000\n  headers:\n    X-Content-Type-Options: [nosniff]\nhealth:\n  storagedriver:\n    enabled: true\n    interval: 10s\n    threshold: 3\nproxy: # 关键镜像仓库配置\n  remoteurl: https://registry-1.docker.io\n  ttl: 168h\n</code></pre>\n<h1>4. 生成 SSL 证书</h1>\n<p>registry 默认使用 HTTP 协议对外提供服务，使用 HTTPS 更安全&amp;更通用。笔者生成自签名证书的命令如下：</p>\n<pre><code class=\"language-shell\">openssl req -x509 -newkey rsa:4096 -sha256 -days 3650 \\\n  -nodes -keyout example.com.key -out example.com.crt -subj \"/CN=example.com\" \\\n  -addext \"subjectAltName=DNS:example.com,DNS:*.example.com,IP:100.x.x.x,IP:192.168.1.30\"\n</code></pre>\n<h1>5. 启动 registry 服务</h1>\n<p>准备好 registry 的存储目录，放入上一步生成的证书文件。然后编写如下 docker-compose 文件：</p>\n<pre><code class=\"language-yaml\">version: '3.1'\nservices:\n  registry:\n    image: registry:2\n    network_mode: \"host\"\n    environment:\n      REGISTRY_HTTP_ADDR: \"0.0.0.0:5000\"\n      REGISTRY_HTTP_TLS_KEY: \"/var/lib/registry/example.com.key\"\n      REGISTRY_HTTP_TLS_CERTIFICATE: \"/var/lib/registry/example.com.crt\"\n      HTTPS_PROXY: \"{HTTP 代理地址}\"\n    restart: always\n    container_name: registry\n    volumes:\n      - \"/{你的路径}/registry:/var/lib/registry\"\n      - \"/{你的路径}/registry_config.yml:/etc/docker/registry/config.yml\"\n</code></pre>\n<p>用 docker-compose 运行容器即可启动服务：</p>\n<pre><code class=\"language-shell\">docker-compose -f registry.yml up -d\n</code></pre>\n<p>此时 registry 会在笔者的服务器上，也就是<code>https://192.168.1.30:5000</code>提供服务。</p>\n<h1>6. 客户端使用</h1>\n<h2>6.1 信任 SSL 证书</h2>\n<p>由于 registry 使用的是自签名 SSL 证书，客户端要想成功拉取镜像需要先信任该证书。方式有两种，第一种是将证书加入客户端的的系统信任列表（推荐）：</p>\n<pre><code class=\"language-shell\">sudo cp /${你的路径}/example.com.crt /usr/share/ca-certificates\nsudo dpkg-reconfigure ca-certificates\n</code></pre>\n<p>然后重启 Docker/K3S 等需要拉取镜像的服务；第二种是让 Docker 拉取镜像时跳过证书校验：</p>\n<pre><code class=\"language-shell\">sudo vim /etc/docker/daemon.json\n</code></pre>\n<pre><code class=\"language-json\">\n{\n  ...\n  \"insecure-registries\": [\"192.168.1.30:5000\"]\n  ...\n}\n</code></pre>\n<p>然后重启 docker 服务。</p>\n<p>信任完证书后，此时就可以拉取 Docker Hub 上的镜像看到效果了：</p>\n<pre><code class=\"language-shell\">docker pull 192.168.1.30:5000/grafana/grafana:main\n</code></pre>\n<h2>6.2 设置 Docker 镜像源</h2>\n<p>同样是编辑<code>/etc/docker/daemon.json</code>，将上述 registry 服务作为 Docker 镜像源：</p>\n<pre><code class=\"language-json\">{\n  ...\n  \"registry-mirrors\": [\n    \"https://192.168.1.30:5000\"\n  ]\n  ...\n}\n</code></pre>\n<p>然后重启 Docker 服务，此时就可以快速拉取镜像了</p>\n<pre><code class=\"language-shell\">docker pull grafana/grafana:main\n</code></pre>\n<p>enjoy!</p>\n", "last_modified": 1717817156, "replies": 30, "id": 1047891}]